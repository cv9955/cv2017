# Cuenta 1



## CABS_ENTREGAS_M
```SQL
CREATE TABLE vic.cabs_entregas_m (
    id            NUMBER NOT NULL,
    fecha         DATE NOT NULL,
    cliente       NUMBER NOT NULL,
    iibb          NUMBER(*,4),
    remito        NUMBER NOT NULL,
    factura_id    NUMBER,
    dfiscal       NUMBER,
    deposito      NUMBER,
    status        NUMBER DEFAULT 1 NOT NULL, -- 1 PREPARADO 2 EMITIDO 3 REVISADO -1 ANULADO
    id_viaje      NUMBER,
    notas         VARCHAR2(400 BYTE),
    subt_neto     NUMBER(*,2),
    subt_iva      NUMBER(*,2),
    subt_iibb     NUMBER(*,2),
    total         NUMBER(*,2),
    created_by    VARCHAR2(20 BYTE),
    created_fec   DATE	
)
```

## CABS_ENTREGAS
```SQL
CREATE TABLE vic.cabs_entregas (
    id            NUMBER NOT NULL,	-- :KEY:
    id_cab        NUMBER NOT NULL,  --> CABS_ENTREGAS_M
    art           NUMBER(*,0),		--> ART
    cant          NUMBER,
    precio        NUMBER(*,4),
    iva           NUMBER(*,4),
    detalle       VARCHAR2(40 BYTE),
    pedido        NUMBER,			--> CABS_PEDIDOS
    created_by    VARCHAR2(20 BYTE),
    created_fec   DATE	
)
```


## CABS_FACTURAS
```SQL
  CREATE TABLE "VIC"."CABS_FACTURAS" 
   (	"ID" NUMBER(*,0) NOT NULL ENABLE, 
	"FECHA" DATE, 
	"TIPO_CAB" NUMBER, 
	"PUNTO_VENTA" NUMBER(*,0), 
	"NRO_CAB" NUMBER(*,0), 
	"CUIT" VARCHAR2(11 BYTE), 
	"DFISCAL" VARCHAR2(80 BYTE), 
	"TOTAL_OPERACION" NUMBER(*,2), 
	"TOTAL_NO_GRAVADO" NUMBER(*,2), 
	"NETO_GRAVADO" NUMBER(*,2), 
	"IMPUESTO_1" NUMBER(*,2), 
	"IMPUESTO_2" NUMBER(*,2), 
	"IMPORTE_OPER_EXENTAS" NUMBER(*,2), 
	"IMPORTE_PERCEP_NAC" NUMBER(*,2), 
	"IMPORTE_PERCEP_IIBB" NUMBER(*,2), 
	"IMPORTE_PERCEP_MUNI" NUMBER(*,2), 
	"IMPORTE_IMP_INTERNOS" NUMBER(*,2), 
	"CAI" VARCHAR2(14 BYTE), 
	CONSTRAINT "CABS_FACTURAS_PK" PRIMARY KEY ("ID") ENABLE, 
	CONSTRAINT "CABS_FACTURAS_FK1" FOREIGN KEY ("TIPO_CAB")
		REFERENCES "VIC"."CABS_TIPO" ("ID") ENABLE
   )
```

## CABS_FACTURAS_DETALLE
```SQL
  CREATE TABLE "VIC"."CABS_FACTURAS_DETALLE" 
   (	"ID" NUMBER NOT NULL ENABLE, 
	"ID_CAB" NUMBER, 
	"FECHA" DATE, 
	"TIPO_CAB" NUMBER, 
	"PUNTO_VENTA" NUMBER, 
	"NRO_CAB" NUMBER, 
	"CANTIDAD" NUMBER(*,2), 
	"UNIDAD" VARCHAR2(2 BYTE), 
	"PRECIO" NUMBER(*,2), 
	"BONIFICACION" NUMBER(*,2), 
	"AJUSTE" NUMBER(*,2), 
	"SUBTOTAL" NUMBER(*,2), 
	"IVA" NUMBER(*,2), 
	"MODO" VARCHAR2(1 BYTE), 
	"ANULADO" VARCHAR2(1 BYTE), 
	"TEXTO" VARCHAR2(75 BYTE), 
	CONSTRAINT "CABS_FACTURAS_DETA_ID_PK" PRIMARY KEY ("ID") ENABLE, 
	CONSTRAINT "CABS_FACTURAS_DETA_ID_CAB_FK" FOREIGN KEY ("ID_CAB")
		REFERENCES "VIC"."CABS_FACTURAS" ("ID") ON DELETE CASCADE ENABLE
   )
```


## CABS_RECIBOS 
```SQL
  CREATE TABLE "VIC"."CABS_RECIBOS" 
   (	"ID" NUMBER(*,0) NOT NULL ENABLE, 
	"FECHA" DATE, 
	"TIPO_CAB" NUMBER, 
	"PUNTO_VENTA" NUMBER(*,0), 
	"NRO_CAB" NUMBER(*,0), 
	"CUIT" VARCHAR2(11 BYTE), 
	"DFISCAL" VARCHAR2(80 BYTE), 
	"TOTAL_OPERACION" NUMBER(*,2), 
	"EFT" NUMBER, 
	"RETENCIONES" NUMBER, 
	"DEPOSITO" NUMBER(*,2), 
	"COMPENSACION" NUMBER(*,2), 
	"ID_RAZON" NUMBER, 
	"OBS" VARCHAR2(400 BYTE), 
	 CONSTRAINT "CABS_RECIBO_PK" PRIMARY KEY ("ID")
	 CONSTRAINT "NRO_RECIBO" UNIQUE ("PUNTO_VENTA", "NRO_CAB")
   ) 
```

## DOCS_CHEQUES
```SQL
  CREATE TABLE "VIC"."DOCS_CHEQUES" 
   (	"ID" NUMBER NOT NULL ENABLE, 
	"FECHA" DATE, 
	"CHEQUE" NUMBER, 
	"BANCO" VARCHAR2(20 BYTE), 
	"VENCIMIENTO" DATE, 
	"CUENTA" VARCHAR2(20 BYTE), 
	"CLIENTE" VARCHAR2(80 BYTE), 
	"IMPORTE" NUMBER(*,2), 
	"ID_RAZON" NUMBER, 
	"RECIBO" NUMBER, 
	"KEY" NUMBER, 
	"RSOCIAL" VARCHAR2(200 BYTE), 
	 CONSTRAINT "DOCS_CHEQUES_PK" PRIMARY KEY ("ID") ENABLE, 
	 CONSTRAINT "DOCS_CHEQUES_UK1" UNIQUE ("KEY")  ENABLE
   )
```   

## CABX_FACT_RECIBO
```SQL
 CREATE TABLE "VIC"."CABX_FACT_RECIBO" 
   (	
	"ID_FACTURA" NUMBER NOT NULL ENABLE, 
	"ID_RECIBO" NUMBER, 
	"VALOR" NUMBER(*,2)
   ) 
```



## CABX_FACT_ENTREGA

# VISTAS

## V1_RECIBOS
|ID|TIPO_CAB|FECHA|CLIENTE|NRO|TOTAL|OBS|PAGO|REMITOS|
```SQL
	SELECT ID, TIPO_CAB, 
		TO_CHAR(PUNTO_VENTA,'FM0000') || '-' || TO_CHAR(NRO_CAB,'FM00000000') NRO, 		
		FECHA, ID_RAZON , TOTAL_OPERACION TOTAL,   
		EFT, 
		(SELECT SUM(IMPORTE)FROM DOCS_CHEQUES WHERE RECIBO = R.ID)	CHEQUES,   
        RETENCIONES,
		DEPOSITO, 
		COMPENSACION,
		OBS,
		(SELECT SUM(X.VALOR) FROM cabX_fact_recibo X WHERE R.ID = x.id_RECIBO) PAGO  ,
		(SELECT LISTAGG(F.NRO_CAB,' ')within group(order by y.id_recibo) 
			FROM cabX_fact_recibo Y ,CABS_FACTURAS F
			WHERE y.id_factura = F.id and y.id_recibo = r.id) REMITOS 
	FROM CABS_RECIBOS R
```

## V1_FACTURAS
```SQL
		SELECT 
            ID,
            TIPO_CAB ,
            FECHA ,
            (SELECT ID FROM CLI_DFISCAL WHERE CUIT = F.CUIT) ID_RAZON,
            CUIT,
            DFISCAL ,
            TO_CHAR(PUNTO_VENTA,'FM0000') || '-' || TO_CHAR(NRO_CAB,'FM00000000') NRO,
            TOTAL_OPERACION      
		FROM CABS_FACTURAS F 
		
		UNION ALL

		SELECT
            -ID ID,
            0 TIPO_CAB ,
            NVL(SALDO_FEC,TO_DATE('01012018','DDMMYYYY')) FECHA ,
            ID ID_RAZON,
            CUIT,
            RAZON_SOCIAL DFISCAL ,
            'SALDO INICIAL' NRO,
            SALDO_INI 
			FROM CLI_DFISCAL
		WHERE NVL(SALDO_INI,0) != 0
```

## CTACTE
|ID|FECHA|TIPO_CAB|SIGNO|NRO_CAB|ID_RAZON|CUIT|RAZON_SOCIAL|TOTAL|

```SQL
	SELECT 
		DF.ID,
		NVL(DF.SALDO_FEC,TO_DATE('01-01-2018', 'DD-MM-YYYY')) FECHA,
		0 TIPO_CAB,
		NULL NRO_CAB,
		DF.CUIT,
		DF.RAZON_SOCIAL,
		DF.SALDO_INI TOTAL,
		1 SIGNO 
    FROM CLI_DFISCAL DF 
		WHERE NOT DF.SALDO_INI IS NULL 

	UNION ALL    

	SELECT 
		R.ID,
		R.FECHA,
		R.TIPO_CAB,
		TO_CHAR(R.PUNTO_VENTA,'FM0000')||'-'||TO_CHAR(R.NRO_CAB,'FM00000000') NRO_CAB,
		R.CUIT,
		DF.RAZON_SOCIAL,
		R.TOTAL_OPERACION,
		-1 SIGNO 
    FROM CABS_RECIBOS R LEFT JOIN CLI_DFISCAL DF ON R.CUIT = DF.CUIT 
		WHERE NOT R.CUIT IS NULL

	UNION ALL 

	SELECT 
		F.ID,
		F.FECHA,
		F.TIPO_CAB,
		TO_CHAR(F.PUNTO_VENTA,'FM0000')||'-'||TO_CHAR(F.NRO_CAB,'FM00000000') NRO_CAB,
		F.CUIT,
		DF.RAZON_SOCIAL,
		F.total_operacion ,
		CASE F.TIPO_CAB WHEN 3 THEN -1 ELSE 1 END SIGNO
    FROM CABS_FACTURAS F LEFT JOIN CLI_DFISCAL DF ON F.CUIT = DF.CUIT
```