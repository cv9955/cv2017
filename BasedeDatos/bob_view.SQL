CREATE OR REPLACE FORCE VIEW "VIC"."VIEW_BOB_MENSUAL" ("PERIODO", "COMPRAS", "CORRUGADO") AS 
  SELECT PERIODO, SUM(COMPRAS) COMPRAS,SUM(CORRUGADO) CORRUGADO FROM (
		SELECT TO_CHAR(O.FECHA,'YYYY/MM') PERIODO,
            SUM(BOB.PESO) COMPRAS,0 CORRUGADO
            FROM BOB_ORDEN O,BOB 
            WHERE O.ID = BOB.ORDEN_INGRESO
            GROUP BY TO_CHAR(O.FECHA,'YYYY/MM'),0
		UNION ALL
        SELECT TO_CHAR(U.FECHA,'YYYY/MM') PERIODO,0 COMPRAS,
            ROUND(SUM(BOB.PESO * U.USO / 100)) CORRUGADO
            FROM BOB_USO U,BOB
            WHERE U.BOBINA = BOB.ID
            GROUP BY TO_CHAR(U.FECHA,'YYYY/MM'),0
		)
		GROUP BY PERIODO;
		
CREATE OR REPLACE FORCE VIEW CTRL_BAJA_BOBINA AS 
	SELECT FECHA, GREATEST (ABS (A-B) , ABS (A-C) ,ABS (B-C)) as dif FROM(
		SELECT FECHA,
			SUM(CASE WHEN LUGAR = 1 THEN BOB_PKG.METROSUSO(ID) ELSE 0 END) AS A,
			SUM(CASE WHEN LUGAR = 2 THEN BOB_PKG.METROSUSO(ID) ELSE 0 END) AS B,
			SUM(CASE WHEN LUGAR = 3 THEN BOB_PKG.METROSUSO(ID) ELSE 0 END) AS C
		FROM BOB_USO 
			GROUP BY FECHA)
	ORDER BY 2 DESC;