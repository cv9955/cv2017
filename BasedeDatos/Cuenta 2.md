# Cuenta 2

## CABS_ENTREGAS_2
```SQL
  CREATE TABLE "VIC"."CABS_ENTREGAS_2" 
   (	"ID" NUMBER NOT NULL ENABLE, 
	"ID_CAB" NUMBER NOT NULL ENABLE, 
	"ART" NUMBER, 
	"CANT" NUMBER, 
	"PRECIO" NUMBER(*,4), 
	"DETALLE" VARCHAR2(40 BYTE), 
	"PEDIDO" NUMBER, 
	"CREATED_BY" VARCHAR2(20 BYTE), 
	"CREATED_FEC" DATE, 
	CONSTRAINT "VC_ENTREGAS2_PK" PRIMARY KEY ("ID"),
	CONSTRAINT "FK_ENTREGAS_2" FOREIGN KEY ("ID_CAB")
		REFERENCES "CABS_ENTREGAS_M2" ("ID") ENABLE, 
	FOREIGN KEY ("ART")		REFERENCES "ART" ("ID") ENABLE, 
	FOREIGN KEY ("PEDIDO")	REFERENCES "CABS_PEDIDOS" ("ID") ENABLE
   ) 
```

## CABS_ENTREGAS_M2
```SQL
	CREATE TABLE "VIC"."CABS_ENTREGAS_M2" 
	(	"ID" NUMBER NOT NULL ENABLE, 
	"FECHA" DATE NOT NULL ENABLE, 
	"CLIENTE" NUMBER NOT NULL ENABLE, 
	"SUBT_NETO" NUMBER, 
	"TOTAL" NUMBER(*,4), 
	"REMITO" NUMBER, 
	"DEPOSITO" NUMBER, 
	"CREATED_BY" VARCHAR2(20 BYTE), 
	"CREATED_FEC" DATE, 
	"STATUS" NUMBER DEFAULT 1 NOT NULL ENABLE, 
	"NOTAS" VARCHAR2(400 BYTE), 
	CONSTRAINT "CABS_ENTREGAS_M2_PK" PRIMARY KEY ("ID"),
    CONSTRAINT "NRO_REMIRO2" UNIQUE ("REMITO"),
	FOREIGN KEY ("DEPOSITO")	REFERENCES "VIC"."CLI_DEPOSITO" ("ID") ENABLE, 
	FOREIGN KEY ("CLIENTE")		REFERENCES "VIC"."CLI" ("ID") ENABLE
   )

```

## CABS_RECIBOS_2 
```SQL
  CREATE TABLE "VIC"."CABS_RECIBOS_2" 
   (	
	"ID" NUMBER(*,0) NOT NULL ENABLE, 
	"FECHA" DATE, 
	"ID_CLIENTE" NUMBER, 
	"NRO_CAB" NUMBER(*,0), 
	"TOTAL_OPERACION" NUMBER(*,2), 
	"EFT" NUMBER, 
	"DEPOSITO" NUMBER(*,2), 
	"COMPENSACION" NUMBER(*,2), 
	"OBS" VARCHAR2(400 BYTE), 
	 CONSTRAINT "CABS_RECIBOS2_PK" PRIMARY KEY ("ID"),
	 CONSTRAINT "NRO_RECIBO2" UNIQUE ("NRO_CAB")
```

## DOCS_CHEQUES_2 
```SQL
 CREATE TABLE "VIC"."DOCS_CHEQUES_2" 
   (	"ID" NUMBER NOT NULL ENABLE, 
	"FECHA" DATE, 
	"CHEQUE" NUMBER, 
	"BANCO" VARCHAR2(20 BYTE), 
	"VENCIMIENTO" DATE, 
	"CUENTA" VARCHAR2(20 BYTE), 
	"CLIENTE" VARCHAR2(80 BYTE), 
	"IMPORTE" NUMBER(*,2), 
	"ID_CLIENTE" NUMBER, 
	"RECIBO" NUMBER, 
	"KEY" NUMBER, 
	"RSOCIAL" VARCHAR2(200 BYTE), 
	 CONSTRAINT "DOCS_CHEQUES_PK2" PRIMARY KEY ("ID"),
	 CONSTRAINT "DOCS_CHEQUES_UK2" UNIQUE ("KEY")
	) 
```

## CABY_FACT_RECIBO
```SQL
 CREATE TABLE "VIC"."CABY_FACT_RECIBO" 
   (	
	"ID_FACTURA" NUMBER NOT NULL ENABLE, 
	"ID_RECIBO" NUMBER, 
	"VALOR" NUMBER(*,2)
   ) 
```

# VISTAS


## V2_RECIBOS
|ID|TIPO_CAB|FECHA|CLIENTE|REMITO|TOTAL|OBS|PAGO|REMITOS|
```SQL
	SELECT ID,
		102 TIPO_CAB,
		NRO_CAB, 		
		FECHA, 
		ID_CLIENTE CLIENTE,
		TOTAL_OPERACION TOTAL,   
		EFT, 
		(SELECT SUM(IMPORTE)FROM DOCS_CHEQUES_2 WHERE RECIBO = R.ID)	CHEQUES,   
		DEPOSITO, 
		COMPENSACION,
		OBS,
		(SELECT SUM(X.VALOR) FROM caby_fact_recibo X WHERE R.ID = x.id_RECIBO) PAGO  ,
		(SELECT LISTAGG(m.REMITO,' ')within group(order by y.id_recibo) 
			FROM caby_fact_recibo Y ,CABS_ENTREGAS_M2 m
			WHERE y.id_factura = m.id and y.id_recibo = r.id) REMITOS 
	FROM CABS_RECIBOS_2 R
```

## V2_REMITOS
|ID|TIPO_CAB|FECHA|CLIENTE|REMITO|TOTAL|OBS|PAGO|RECIBOS|
```SQL
	SELECT F.ID,
        F.TIPO_CAB,	
		F.REMITO,		
		F.FECHA,
		F.CLIENTE,		
		F.TOTAL,
		F.OBS,
		(SELECT SUM(X.VALOR) 
			FROM caby_fact_recibo X WHERE F.ID = x.id_factura) PAGO,
		(SELECT LISTAGG(R.NRO_CAB,':')within group(order by y.id_factura) 
			FROM caby_fact_recibo Y ,CABS_RECIBOS_2 R
			WHERE y.id_recibo = r.id and y.id_factura = f.id) recibos
	FROM (            
		SELECT 101 tipo_cab,ID,FECHA ,CLIENTE ,TOTAL ,REMITO, NOTAS OBS 
		FROM CABS_ENTREGAS_M2
		
		UNION ALL

		SELECT 0 TIPO_CAB,-ID ID ,TO_DATE('01012018','DDMMYYYY') FECHA,ID CLIENTE,
			SALDO_INI TOTAL ,0 REMITO,'SALDO INICIAL' OBS 
			FROM CLI
		WHERE SALDO_INI IS NOT NULL
		) F
```

## CTACTE2
|ID|FECHA|NRO_CAB|TIPO_CAB|CLIENTE|TOTAL|OBS|SIGNO|
```SQL
select ID ,REMITO NRO_CAB ,FECHA ,
	tipo_cab,1 signo, CLIENTE ,TOTAL ,OBS, PAGO, 
	TOTAL-NVL(PAGO,0) AS SIN_APLICAR,
	TOTAL DEBE,NULL HABER,RECIBOS APLICACION
from V2_REMITOS 
union all
select ID ,NRO_CAB ,FECHA ,
	tipo_cab,-1 signo,CLIENTE ,TOTAL ,OBS  , PAGO, 
	TOTAL-NVL(PAGO,0) AS SIN_APLICAR,
	NULL DEBE , TOTAL HABER,REMITOS APLICACION
from V2_RECIBOS
``` 




## TIPO_CAB
|ID|COD|TIPO_CAB|
|0|INI|SALDO INICIAL|
|1|FAC|FACTURA|
|2|N/D|NOTA DE DEBITO|
|3|N/C|NOTA DE CREDITO|
|9|FAC EXPO|FACT EXPORTACION|
|19|REC|RECIBO|
|101|COB|COBRANZA|
|102|ENT|ENTREGA|
